let isSending = false;

async function sendMessage() {
  if (isSending) return; // prevent rapid sending
  isSending = true;

  const userText = input.value.trim();
  if (!userText) {
    isSending = false;
    return;
  }

  chatBox.innerHTML += `<div class="message user"><b>You:</b> ${userText}</div>`;
  input.value = "";
  typing.style.display = "block";
  chatBox.scrollTop = chatBox.scrollHeight;

  try {
    const res = await fetch("https://pathakgpt-gemini.onrender.com/ask", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message: userText })
    });
    const data = await res.json();
    chatBox.innerHTML += `<div class="message bot"><b>PathakGPT:</b> ${data.text}</div>`;
    if (data.error) {
      console.error("Gemini API error detail:", data.error);
    }
  } catch {
    chatBox.innerHTML += `<div class="message bot"><b>PathakGPT:</b> Could not connect.</div>`;
  }

  typing.style.display = "none";
  chatBox.scrollTop = chatBox.scrollHeight;

  setTimeout(() => {
    isSending = false;
  }, 2000); // 2 sec cooldown
}
